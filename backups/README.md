# Backups Directory

This directory stores backup archives of bot data and configurations.

## Purpose

Backups contain all variable/runtime data needed to restore a bot to a working state:

- User databases (.user files)
- Channel databases (.chan files)
- Notes databases (.notes files)
- Docker Compose overrides (if they exist)
- Ansible variable overrides (if they exist)
- PISG cache, customizations, and output
- Eggdrop logs

## What's NOT Backed Up

The following are NOT included in backups as they're already version controlled:

- Generated configs (eggdrop.conf, pisg.cfg) - regenerated by Ansible
- README files
- Repository code and templates

## Manually Creating Backups

Run the backup playbook for the bot you want to backup:

```bash
ansible-playbook backup-pompone.yml
```

This will create a timestamped backup file:

```text
backups/pompone-backup-2023-12-08.tar.gz
```

## Automated Backups

Upon deploy using the `deploy-botname.yml` playbook, a cronjob is created to run these backups daily.

## Backup Retention

Backups older than 30 days (configurable) are automatically deleted when a new backup is created.

To change retention period, edit the playbook:

```yaml
backup_retention_days: 30  # Adjust this value
```

## Backup Contents

Each backup contains the following structure:

```text
pompone-backup-YYYY-MM-DD.tar.gz
├── data/                    # Bot runtime data
│   ├── Pompone2.user
│   ├── Pompone2.chan
│   └── Pompone2.notes
├── overrides/               # Local customizations
│   ├── docker-compose.override.yml
│   └── overrides.yml
├── html/                    # Generated statistics
│   └── ...                  # Sub-directories are preserved
├── logs/                    # IRC logs
│   └── ...                  # Sub-directories are preserved
├── pisg-cache/              # PISG processing cache
└── pisg-config/             # PISG customizations (with the exception of checked in files)
```

## Important Notes

- All backup files in this directory are gitignored
- Backups may contain sensitive data (user passwords, channel keys)
- Store backups securely with appropriate permissions (0600)
- Test your restore procedure periodically!
