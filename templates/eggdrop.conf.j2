#! /home/eggdrop/eggdrop/eggdrop
# Eggdrop configuration for {{ bot_nick }}
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

## Global
set username {{ bot_username }}
set admin "{{ bot_admin }}"
set network "{{ irc_network }}"
set timezone "{{ ansible_date_time.tz }}"
set offset "{{ timezone_offset }}"

set prefer-ipv6 {{ prefer_ipv6 | default(1) }}

## Logs
# Logfile flags:
#   b - information about bot linking and userfile sharing
#   c - commands
#   d - misc debug information
#   h - raw share traffic
#   j - joins, parts, quits, and netsplits on the channel
#   k - kicks, bans, and mode changes on the channel
#   m - private msgs, notices and ctcps to the bot
#   o - misc info, errors, etc (IMPORTANT STUFF)
#   p - public text on the channel
#   r - raw incoming server traffic
#   s - server connects, disconnects, and notices
#   t - raw botnet traffic
#   v - raw outgoing server traffic
#   w - wallops (make sure the bot sets +w in init-server)
#   x - file transfers and file-area commands
set max-logs 5
set max-logsize 0
{% if separate_log_dirs | default(false) %}
logfile mco * "logs/bot/{{ bot_nick }}.log"
{% for channel in channels %}
logfile jkp {{ channel.name }} "logs/channels/{{ channel.name | replace('#', '') }}.log"
{% endfor %}
{% else %}
logfile mco * "logs/{{ bot_nick }}.log"
{% for channel in channels %}
logfile jkp {{ channel.name }} "logs/{{ channel.name | replace('#', '') }}.log"
{% endfor %}
{% endif %}
set log-time 1
set keep-all-logs 1
set logfile-suffix ".%Y%m%d"
set switch-logfiles-at 200
set quiet-save 1

## Console
set console "mkcobxs"

## Files
set userfile "data/{{ bot_nick }}.user"
set sort-users 0
set help-path "help/"
set text-path "text/"
set motd "text/motd"
set telnet-banner "text/banner"
set userfile-perm 0600

## Botnet/DCC/Telnet
listen {{ dcc_port }} all
set reserved-portrange {{ dcc_portrange_start }}:{{ dcc_portrange_end }}
set remote-boots 0
set share-unlinks 1
set protect-telnet 1
set dcc-sanitycheck 0
set ident-timeout 5
set require-p 0
set open-telnets 0
set stealth-telnets 1
set stealth-prompt "login: "
set use-telnet-banner 0
set connect-timeout 15
set dcc-flood-thr 3
set telnet-flood 5:60
set paranoid-telnet-flood 1
set ignore-time 15

set owner "{{ bot_owner }}"
set default-flags "fop"
set whois-fields ""
set die-on-sighup 0
set die-on-sigterm 1
set must-be-owner 2
unbind dcc n simul *dcc:simul
set max-socks 100
set dupwait-timeout 5
set cidr-support 1

## Modules
set mod-path "modules/"

loadmodule pbkdf2
loadmodule blowfish
set blowfish-use-mode ecb
loadmodule dns
loadmodule ident

loadhelp userinfo.help

set ident-method 0

loadmodule channels
set chanfile data/{{ bot_nick }}.chan
set use-info 1

set default-flood-chan 35:60
set default-flood-deop 3:10
set default-flood-kick 3:10
set default-flood-join 8:60
set default-flood-ctcp 3:60
set default-flood-nick 8:60
set default-aop-delay 5:30
set default-idle-kick 0
set default-chanmode "nt"
set default-stopnethack-mode 0
set default-revenge-mode 0
set default-ban-time 300
set default-exempt-time 60
set default-invite-time 60
set default-chanset {
        -autoop         -autovoice
        -bitch          +cycle
        +dontkickops    +dynamicbans
        +dynamicexempts +dynamicinvites
        -enforcebans    +greet
        -inactive       -nodesynch
        -protectfriends -protectops
        -revenge        -revengebot
        -secret         -seen
        +shared         +statuslog
        +userbans       +userexempts
        +userinvites    -protecthalfops
        -autohalfop
}

## Static Channels
{% for channel in channels %}

channel add {{ channel.name }} {
        chanmode "{{ channel.mode }}"
        idle-kick {{ channel.idle_kick }}
        stopnethack-mode {{ channel.stopnethack_mode }}
        revenge-mode {{ channel.revenge_mode }}
        ban-time {{ channel.ban_time }}
}

channel set {{ channel.name }} {{ channel.flags }}
{% endfor %}

loadmodule server
set net-type "{{ irc_network }}"
set nick "{{ bot_nick }}"
set altnick "{{ bot_nick }}-"
set realname "{{ bot_realname }}"
bind evnt - init-server evnt:init_server

proc evnt:init_server {type} {
  global botnick
  putquick "MODE $botnick +i-ws"
}

set default-port 6667
{% for server in irc_servers %}
{% if server.port is defined %}
{% if server.password is defined %}
server add {{ server.host }} {{ server.port }} {{ server.password }}
{% else %}
server add {{ server.host }} {{ server.port }}
{% endif %}
{% else %}
server add {{ server.host }}
{% endif %}
{% endfor %}
set msg-rate 2
set keep-nick 1
set quiet-reject 1
set lowercase-ctcp 1
set answer-ctcp 3
set flood-msg 5:60
set flood-ctcp 3:60
set never-give-up 1
set server-cycle-wait 60
set server-timeout 60
set servlimit 0
set check-stoned 1
set serverror-quit 1
set max-queue-msg 300
set trigger-on-ignore 0
set exclusive-binds 0
set double-mode 1
set double-server 1
set double-help 1
set optimize-kicks 1
set stack-limit 4

loadmodule ctcp
set ctcp-mode 1

loadmodule irc
set bounce-bans 0
set bounce-exempts 0
set bounce-invites 0
set bounce-modes 0
set learn-users 0
set wait-split 600
set wait-info 180
set mode-buf-length 200
set opchars "@"
unbind msg - addhost *msg:addhost

loadmodule share
set allow-resync 0
set private-global 0
set private-globals "pn"
set private-user 0
set override-bots 0

loadmodule transfer
set max-dloads 3
set dcc-block 0
set xfer-timeout 30

loadmodule notes
set notefile data/{{ bot_nick }}.notes
set max-notes 50
set note-life 60
set allow-fwd 0
set notify-users 1
set notify-onjoin 1

loadmodule console
set console-autosave 1
set force-channel 0
set info-party 0

## Scripts
{% for script in bot_scripts %}
source {{ script }}
{% endfor %}

{% if extra_config is defined and extra_config | length > 0 %}
## Additional Configuration
{{ extra_config }}
{% endif %}
